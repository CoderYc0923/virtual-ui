import{d as t,m as d,p as e,o as a,a as l,C as r,g as s,b as n,s as o,q as u,j as i,x as c,k as h,e as p,R as b,u as v,y as m,w as f,S as g,U as k,l as y}from"./vue-90884f3d.js";import{d as _,e as E,_ as B}from"./index-a7ba88c7.js";const S={class:"test-box relative"},C={style:{color:"white"}},x=["src"],w={key:1},A={class:"danmu-suspend"},M=["onClick"],j=["onClick","id"],z={class:"controler-content"},L=B(t({__name:"baseBarrage",setup(t){const y=d(),B=e({useSlot:!0,useSuspendSlot:!0,isSuspend:!0,randomChannel:!0,loop:!1,right:20,channels:6,speeds:50,opacity:1,extraStyle:"color: white"}),L=d(""),P=d(1),$=d([]),D=d([]),I=()=>{const t=[];return _.map(((d,e)=>{t.push({id:e,text:d,avatar:e%25!=0?E(`default-avatar (${e%25}).png`):""}),D.value.push(!1)})),t},q=()=>{console.log("循环播放一轮结束")},F=(t,d)=>{console.log("当前点击的弹幕: ",d,t)},R=t=>{console.log("播放结束",t)},U=()=>{B.loop=!B.loop,Q("reset")},H=t=>{B.speeds=B.speeds+t>0?B.speeds+t:B.speeds,Q("reset")},V=t=>{B.channels=0===t?0:B.channels+t<0?B.channels:B.channels+t,Q("reset")},T=()=>{var t;if(!L.value)return;let d="";d=B.useSlot?{id:$.value.length,text:L.value,avatar:E(`default-avatar (${Math.ceil(24*Math.random())}).png`),isMe:!0}:L.value,null==(t=y.value)||t.insert(d),L.value=""},G=t=>{({slot:J,suspend:K,suspendslot:N})[t]()},J=()=>{B.useSlot=!B.useSlot,B.useSlot?$.value=I():$.value=_},K=()=>{B.isSuspend=!B.isSuspend},N=()=>{B.useSuspendSlot=!B.useSuspendSlot},O=()=>{B.opacity=P.value},Q=t=>{var d,e,a,l,r,s,n;switch(t){case"play":null==(d=y.value)||d.play();break;case"stop":null==(e=y.value)||e.pause();break;case"hide":null==(a=y.value)||a.hide();break;case"show":null==(l=y.value)||l.show();break;case"clear":null==(r=y.value)||r.clear();break;case"reset":null==(s=y.value)||s.reset();break;case"resize":null==(n=y.value)||n.resize()}};return a((()=>{window.onresize=()=>Q("resize"),new Promise((t=>{let d=[];for(let l=1;l<=24;l++)d.push(E(`default-avatar (${l}).png`));let e=0;const a=()=>{e++,e>=d.length&&t("图片加载完成")};d.forEach((t=>{const d=new Image;d.addEventListener("load",a),d.addEventListener("error",a),d.src=t}))})),B.useSlot?$.value=I():$.value=_})),l((()=>{window.onreset=null})),(t,d)=>{const e=r("vir-barrage"),a=r("vir-button"),l=r("vir-row");return s(),n("div",S,[o(e,b({class:"barrage w-full h-300",ref_key:"barrageRef",ref:y,barrage:v($)},v(B),{onDmClick:F,onPlayEnd:R,onListEnd:q}),{test:u((({barrageList:t})=>[i("span",C,c(t),1)])),dm:u((({barrage:t})=>[i("div",{class:p(["danmu-item",[(null==t?void 0:t.isMe)?"btn-item--me":""]])},[(null==t?void 0:t.avatar)?(s(),n("img",{key:0,class:"danmu-item--avatar",src:t.avatar,alt:""},null,8,x)):h("",!0),(null==t?void 0:t.isMe)?(s(),n("span",w,"我:")):h("",!0),i("div",null,c(null==t?void 0:t.text),1)],2)])),suspend:u((({barrage:t,index:d})=>[i("div",A,[i("div",{class:"item",onClick:d=>(t=>{var d;const e={...t,isMe:!0};null==(d=y.value)||d.insert(e)})(t)},"➕",8,M),i("span",{onClick:t=>(t=>{const d=document.getElementById(`star${t}`);null==d||d.setAttribute("dataBefore","🧡")})(d),id:`star${d}`,dataBefore:"🤍"},null,8,j)])])),_:1},16,["barrage"]),i("div",z,[o(l,{class:"mb-4"},{default:u((()=>[m(" 播放： "),o(a,{onClick:d[0]||(d[0]=t=>Q("play"))},{default:u((()=>[m("播放")])),_:1}),o(a,{onClick:U},{default:u((()=>[m(c(v(B).loop?"循环播放":"单次播放"),1)])),_:1}),o(a,{onClick:d[1]||(d[1]=t=>Q("stop"))},{default:u((()=>[m("暂停")])),_:1}),o(a,{onClick:d[2]||(d[2]=t=>Q("clear"))},{default:u((()=>[m("清除")])),_:1})])),_:1}),o(l,{class:"mb-4"},{default:u((()=>[m(" 循环： "),o(a,{onClick:d[3]||(d[3]=t=>G("slot"))},{default:u((()=>[m(c(v(B).useSlot?"插槽":"文字")+"模式",1)])),_:1}),o(a,{onClick:d[4]||(d[4]=t=>G("suspend"))},{default:u((()=>[m(c(v(B).isSuspend?"已开启":"已关闭")+"悬浮停留",1)])),_:1}),o(a,{onClick:d[5]||(d[5]=t=>G("suspendslot"))},{default:u((()=>[m(c(v(B).useSuspendSlot?"已开启":"已关闭")+"悬浮停留插槽",1)])),_:1})])),_:1}),o(l,{class:"mb-4"},{default:u((()=>[m(" 显示： "),o(a,{onClick:d[6]||(d[6]=t=>Q("show"))},{default:u((()=>[m("显示")])),_:1}),o(a,{onClick:d[7]||(d[7]=t=>Q("hide"))},{default:u((()=>[m("隐藏")])),_:1})])),_:1}),o(l,{class:"mb-4"},{default:u((()=>[m(" 透明度： "),f(i("input",{class:"input",type:"number",placeholder:"输入透明度值(0-1)","onUpdate:modelValue":d[8]||(d[8]=t=>k(P)?P.value=t:null)},null,512),[[g,v(P)]]),o(a,{onClick:O},{default:u((()=>[m("确定")])),_:1})])),_:1}),o(l,{class:"mb-4"},{default:u((()=>[m(" 速度： "),o(a,{onClick:d[9]||(d[9]=t=>H(-10))},{default:u((()=>[m("减速")])),_:1}),o(a,{onClick:d[10]||(d[10]=t=>H(10))},{default:u((()=>[m("加速")])),_:1}),m("    当前速度："+c(v(B).speeds)+"像素/s ",1)])),_:1}),o(l,{class:"mb-4"},{default:u((()=>[m(" 轨道： "),o(a,{onClick:d[11]||(d[11]=t=>V(-1))},{default:u((()=>[m("-1")])),_:1}),o(a,{onClick:d[12]||(d[12]=t=>V(1))},{default:u((()=>[m("+1")])),_:1}),o(a,{onClick:d[13]||(d[13]=t=>V(0))},{default:u((()=>[m("满屏")])),_:1}),m("    当前轨道数："+c(v(B).channels),1)])),_:1}),o(l,{class:"mb-4"},{default:u((()=>[m(" 发送： "),f(i("input",{class:"input",type:"text",placeholder:"输入弹幕内容","onUpdate:modelValue":d[14]||(d[14]=t=>k(L)?L.value=t:null)},null,512),[[g,v(L)]]),o(a,{onClick:T},{default:u((()=>[m("发送")])),_:1})])),_:1})])])}}}),[["__scopeId","data-v-d7ce383e"]]),P={class:"markdown-body"},$=y('<h1 id="barrage-%E5%BC%B9%E5%B9%95%E6%8F%92%E4%BB%B6(%E5%85%BC%E5%AE%B9-pc%E3%80%81h5)" tabindex="-1">Barrage 弹幕插件(兼容 PC、H5)</h1><p>一个<code>轻便</code> <code>开箱即用</code> <code>高自由度</code>的弹幕插件,支持 [文本、插槽] 两种模式的弹幕,适合各类弹幕需求场景,例如:视频、直播、H5 互动、广告等</p><h2 id="%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95" tabindex="-1">基础用法</h2><blockquote><p>Tip:<br> 1.异步加载的弹幕数据需手动调用<code>play()</code>方法进行弹幕播放, 此时<code>autoplay</code>属性失效。 <br> 2.为考虑到性能,建议在弹幕数据量大时采用 <code>insert()</code>方式插入弹幕 <br> 3. 弹幕数据格式自定义,故可实现高自由度的弹幕样式、事件等 <br> 4. 由于弹幕组件设计方案问题,导致类似点赞等功能不能通过改动<code>danmus</code>数据响应式实现,即点赞样式与数据需分离处理,若需要实时点赞效果,可借鉴下方案例实现方式</p></blockquote>',4),D=y('<h2 id="barrage-%E5%B1%9E%E6%80%A7" tabindex="-1">Barrage 属性</h2><table><thead><tr><th>属性</th><th>说明</th><th>类型</th><th>可选值</th><th>默认值</th></tr></thead><tbody><tr><td>danmus</td><td>弹幕列表</td><td>array</td><td>—</td><td>[]</td></tr><tr><td>channels</td><td>轨道数量,0 撑满容器</td><td>number</td><td>—</td><td>0</td></tr><tr><td>autoplay</td><td>自动播放</td><td>boolean</td><td>—</td><td>true</td></tr><tr><td>loop</td><td>循环播放</td><td>boolean</td><td>—</td><td>true</td></tr><tr><td>useSlot</td><td>使用插槽</td><td>boolean</td><td>—</td><td>false</td></tr><tr><td>useSuspendSlot</td><td>使用悬浮停留插槽</td><td>boolean</td><td>—</td><td>false</td></tr><tr><td>debounce</td><td>弹幕刷新率(ms)</td><td>number</td><td>—</td><td>100</td></tr><tr><td>speeds</td><td>弹幕速度(像素/秒)</td><td>number</td><td>—</td><td>100</td></tr><tr><td>randomChannel</td><td>是否随即轨道注入弹幕</td><td>boolean</td><td>—</td><td>false</td></tr><tr><td>fontSize</td><td>弹幕字号</td><td>number</td><td>—</td><td>18</td></tr><tr><td>top</td><td>弹幕垂直间距(px)</td><td>number</td><td>—</td><td>10</td></tr><tr><td>right</td><td>弹幕水平间距(px)</td><td>number</td><td>—</td><td>10</td></tr><tr><td>isSuspend</td><td>是否开启弹幕悬浮停留</td><td>boolean</td><td>—</td><td>false</td></tr><tr><td>extraStyle</td><td>弹幕额外样式</td><td>string</td><td>—</td><td>“”</td></tr><tr><td>opacity</td><td>弹幕透明度(0-1)</td><td>number</td><td>—</td><td>1</td></tr></tbody></table><h2 id="barrage-%E5%86%85%E7%BD%AE%E6%96%B9%E6%B3%95" tabindex="-1">Barrage 内置方法</h2><table><thead><tr><th>方法名</th><th>说明</th><th>参数</th></tr></thead><tbody><tr><td>play</td><td>开始/继续播放</td><td>—</td></tr><tr><td>pause</td><td>暂停弹幕播放</td><td>—</td></tr><tr><td>clear</td><td>停止播放并清空弹幕</td><td>—</td></tr><tr><td>show</td><td>弹幕显示</td><td>—</td></tr><tr><td>hide</td><td>弹幕隐藏</td><td>—</td></tr><tr><td>reset</td><td>重置配置（也可在改变播放区域大小后调用）</td><td>—</td></tr><tr><td>resize</td><td>容器尺寸改变时重新计算滚动距离</td><td>—</td></tr><tr><td>push</td><td>发送弹幕（插入到弹幕列表末尾，排队显示）</td><td>弹幕数据，string\\object</td></tr><tr><td>add</td><td>发送弹幕（插入到当前播放位置，实时显示）</td><td>弹幕数据，string\\object</td></tr><tr><td>insert</td><td>绘制弹幕（实时插入，不存入弹幕队列）</td><td>弹幕数据，string\\object</td></tr><tr><td>getPlayState</td><td>获得当前播放状态</td><td>—</td></tr><tr><td>getInsertList</td><td>获取使用 insert 方法插入的弹幕列表</td><td>—</td></tr></tbody></table><h2 id="barrage-%E4%BA%8B%E4%BB%B6" tabindex="-1">Barrage 事件</h2><table><thead><tr><th>事件名</th><th>说明</th><th>回调参数</th></tr></thead><tbody><tr><td>list-end</td><td>所有弹幕插入完毕</td><td>-</td></tr><tr><td>play-end</td><td>所有弹幕播放完成（已滚出屏幕）</td><td>最后一个弹幕的下标 index</td></tr><tr><td>dm-click</td><td>点击相应弹幕</td><td>当前弹幕数据、index</td></tr></tbody></table><h2 id="barrage-%E6%8F%92%E6%A7%BD" tabindex="-1">Barrage 插槽</h2><table><thead><tr><th>插槽名</th><th>说明</th><th>回调参数</th></tr></thead><tbody><tr><td>—</td><td>默认插槽</td><td>-</td></tr><tr><td>dm</td><td>自定义弹幕插槽</td><td>当前弹幕数据、index</td></tr><tr><td>suspend</td><td>自定义弹幕悬浮插槽</td><td>当前弹幕数据、index</td></tr></tbody></table>',8),I={__name:"README",setup:(t,{expose:d})=>(d({frontmatter:{}}),(t,d)=>{const e=r("show-code");return s(),n("div",P,[$,o(e,{showPath:"barrage/components/baseBarrage"},{default:u((()=>[o(L)])),_:1}),D])})};export{I as default};
